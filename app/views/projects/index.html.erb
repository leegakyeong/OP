<br>
<h1 class="ui center aligned header">흥미로운 프로젝트를 찾아 보세요!</h1>

<div class="ui stackable", id="this_form">
  <%= form_tag(search_url, method: :get) %>
    <div class="ui input huge fluid action">
      <%= search_field_tag 'keyword' %>
      <button class="ui icon button huge">
        <i class="search icon"></i>
      </button>
      <span id="filter" class="ui icon button huge">
        <i class="filter icon"></i>
      </span>
    </div>
    <div class="ui segment filter" id="filter-board" style="display: none;">
      <!--프로젝트명이랑 책임자 이름은 그냥 입력해서 검색하게 함.
      # 들어가면 태그로 인식하게 하기?! 정규표현식 써야 하나 어떻게 하는지 찾아 보기-->
      <div class = "ui form">
        <table class="ui very basic table">
          <tr class="filter-board-attribute">
            <td><%= label_tag "검색 방식" %></td>
              <td><%= select_tag :orAnd, options_for_select([["OR", "OR", {class: "item"}], ["AND", "AND", {class: "item"}]]), class: "ui dropdown" %></td>
              <td><%= label_tag "책임자 이름" %></td>
              <td><%= text_field_tag "admin", nil, class: "field" %></td>
          </tr>
          <tr class="filter-board-attribute">
            <td><%= label_tag "최대 인원(1~20)" %></td>
            <td><%= number_field_tag "maxMember", "20", min: 1, max: 20 %></td>
            <td><%= label_tag "사용 언어" %></td>
            <td>
              <div class = "field">
                <div class = "ui radio checkbox">
                  <input type="radio" name="isKorean" value="true">
                  <label>한국어</label>
                </div>
              </div>
              <div class = "field">
                <div class = "ui radio checkbox">
                  <input type="radio" name="isKorean" value="false">
                  <label>English</label>
                </div>
              </div>
            </td>
          </tr>
          <tr class="filter-board-attribute">
            <td><label>협업 방식</label></td>
            <td>
              <div class = "field">
                <div class="ui radio checkbox">
                <input type="radio" name="isOnline" value="true">
                <label>재택/온라인</label>
                </div>
              </div>
              <div class = "field">
                <div class = "ui radio checkbox">
                  <input type="radio" name="isOnline" value="false">
                  <label>오프라인 모임</label>
                </div>
              </div>
            </td>
            <td><label>모집 마감 여부</label></td>
            <td>
              <div class = "ui checkbox">
                <%= check_box_tag "isClosed" %>
                <label>마감</label>
              </div>
            </td>
          </tr>
          <tr class="filter-board-attribute">
            <td><label>스킬 (최대 3개 입력 가능)</label></td>
            <td>
              <%= text_field_tag "skill1" %>
              <%= text_field_tag "skill2" %>
              <%= text_field_tag "skill3" %>
            </td>
            <td><label>도구 (최대 3개 입력 가능)</label></td>
            <td>
              <%= text_field_tag "tool1" %>
              <%= text_field_tag "tool2" %>
              <%= text_field_tag "tool3" %>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </form>
</div>

<h2>Featured Projects</h2>
<div class = "ui cards ui grid">
  <% @projects.sort_by{ |p| p.project_likes.where(created_at: Time.current.all_month).length }.reverse.each_with_index do |p, i| %>
    <div class="four wide column">
      <% if i < 4 %>
        <div class="ui card">
          <div class = "content">
            <div class = "header"><%= link_to p.title, p, class: "project-title" %></div>
            <div class = "meta"><%= link_to p.admin.name, "user/#{p.admin.id}", class: "project-admin" %></div>
            <% if p.isClosed == true %><a class="ui red label">완료</a>
            <% else %><a class="ui blue label">진행중</a>
            <% end %></br>
            <div class = "description"><%=p.description%></div>
          </div>
          <div class = "extra content">
            <% p.tags.each do |tag| %>
              <%= link_to tag.content, search_url(:keyword => tag.content, :maxMember => "20", 
              :skill1 => "", :skill2 => "", :skill3 => "", :tool1 => "", :tool2 => "", :tool3 => ""), class: "ui label", style: "margin-bottom: 5px;", method: :get %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>

  <br>
  <h2>All Projects</h2>
  <div id="featured-projects-box">
    <% @projects_bypage.each_with_index do |p, i| %>
      <div class="ui segment">
        <%= link_to p.title, p, class: "project-title ui header" %><br>
        <%= link_to p.admin.name, "user/#{p.admin.id}", class: "project-admin" %><br>
        <% if p.isClosed == true %><a class="ui red label">완료</a>
        <% else %><a class="ui blue label">진행중</a>
        <% end %></br>
        <%= p.description %><br><br>
        <% p.tags.each do |tag| %>
          <%= link_to tag.content, search_url(:keyword => tag.content, :maxMember => "20", 
                :skill1 => "", :skill2 => "", :skill3 => "", :tool1 => "", :tool2 => "", :tool3 => ""), class: "ui label", style: "margin-bottom: 5px;",method: :get %>
        <% end %>
      </div>
    <% end %>
  </div>
  <br>

  <div style = "display: flex; justify-content: center;">
    <%= paginate @projects_bypage%>
  </div>
  <br><br>

<script>
  $(document).ready(function() {
    $("#filter").on('click', function() {
      $("#filter-board").toggle();
    });
  });  
</script>
